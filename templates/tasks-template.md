# **タスク：[機能名]**

**入力**: `/specs/[###-機能名]/`からの設計ドキュメント
**前提条件**: `plan.md`（必須）、`research.md`、`data-model.md`、`contracts/`

## **実行フロー (main)**

```
1. 機能ディレクトリから`plan.md`を読み込む
   → 見つからない場合: エラー "実装計画が見つかりません"
   → 抽出: 技術スタック、ライブラリ、構造
2. オプションの設計ドキュメントを読み込む:
   → `data-model.md`: エンティティを抽出 → モデルタスク
   → `contracts/`: 各ファイル → 契約テストタスク
   → `research.md`: 決定事項を抽出 → セットアップタスク
3. カテゴリ別にタスクを生成:
   → セットアップ: プロジェクト初期化、依存関係、リンティング
   → テスト: 契約テスト、結合テスト
   → コア: モデル、サービス、CLIコマンド
   → 統合: DB、ミドルウェア、ロギング
   → 仕上げ: 単体テスト、パフォーマンス、ドキュメント
4. タスクルールを適用:
   → ファイルが異なる = 並行実行可能として[P]をマーク
   → 同じファイル = 順次実行（[P]なし）
   → 実装の前にテスト（TDD）
5. タスクに連番を付与（T001, T002...）
6. 依存関係グラフを生成
7. 並行実行の例を作成
8. タスクの完全性を検証:
   → すべての契約にテストがあるか？
   → すべてのエンティティにモデルがあるか？
   → すべてのエンドポイントが実装されているか？
9. 戻り値: 成功（実行準備完了）
```

## **フォーマット: `[ID] [P?] 説明`**

- **[P]**: 並行して実行可能（ファイルが異なり、依存関係がない）
- 説明には正確なファイルパスを含めること

## **パスの慣例**

- **単一プロジェクト**: リポジトリルートの`src/`、`tests/`
- **ウェブアプリ**: `backend/src/`、`frontend/src/`
- **モバイル**: `api/src/`、`ios/src/` または `android/src/`
- 以下に示すパスは単一プロジェクトを想定 - `plan.md`の構造に基づいて調整すること

## **フェーズ 3.1：セットアップ**

- [ ] T001 実装計画に従ってプロジェクト構造を作成
- [ ] T002 [言語]プロジェクトを[フレームワーク]の依存関係で初期化
- [ ] T003 [P] リンティングとフォーマットツールを設定

## **フェーズ 3.2：テストファースト（TDD）⚠️ 3.3 より前に**

**重要: これらのテストは、いかなる実装の前に**必ず**書かれ、必ず失敗しなければならない**

- [ ] T004 [P] `tests/contract/test_users_post.py`に`POST /api/users`の契約テスト
- [ ] T005 [P] `tests/contract/test_users_get.py`に`GET /api/users/{id}`の契約テスト
- [ ] T006 [P] `tests/integration/test_registration.py`にユーザー登録の結合テスト
- [ ] T007 [P] `tests/integration/test_auth.py`に認証フローの結合テスト

## **フェーズ 3.3：コア実装（テストが失敗した**後**にのみ）**

- [ ] T008 [P] `src/models/user.py`にユーザーモデルを作成
- [ ] T009 [P] `src/services/user_service.py`に UserService の CRUD を実装
- [ ] T010 [P] `src/cli/user_commands.py`に`--create-user`の CLI コマンドを実装
- [ ] T011 `POST /api/users`エンドポイントを実装
- [ ] T012 `GET /api/users/{id}`エンドポイントを実装
- [ ] T013 入力検証を実装
- [ ] T014 エラー処理とロギングを実装

## **フェーズ 3.4：統合**

- [ ] T015 UserService を DB に接続
- [ ] T016 認証ミドルウェアを実装
- [ ] T017 リクエスト/レスポンスのロギングを実装
- [ ] T018 CORS とセキュリティヘッダーを実装

## **フェーズ 3.5：仕上げ**

- [ ] T019 [P] `tests/unit/test_validation.py`に検証の単体テスト
- [ ] T020 パフォーマンステスト（\<200ms）
- [ ] T021 [P] `docs/api.md`を更新
- [ ] T022 重複を削除
- [ ] T023 `manual-testing.md`を実行

## **依存関係**

- 実装（T008-T014）の前にテスト（T004-T007）
- T008 が T009、T015 をブロック
- T016 が T018 をブロック
- 仕上げ（T019-T023）の前に実装

## **並行実行の例**

```
# T004-T007を同時に実行:
タスク: "`tests/contract/test_users_post.py`に`POST /api/users`の契約テスト"
タスク: "`tests/contract/test_users_get.py`に`GET /api/users/{id}`の契約テスト"
タスク: "`tests/integration/test_registration.py`にユーザー登録の結合テスト"
タスク: "`tests/integration/test_auth.py`に認証の結合テスト"
```

## **注記**

- `[P]`タスク = ファイルが異なり、依存関係がない
- 実装する前に、テストが失敗することを確認
- 各タスク完了後にコミット
- 避けるべきこと: 曖昧なタスク、同じファイルの競合

## **タスク生成ルール**

_`main()`の実行中に適用_

1.  **契約から**:

    - 各契約ファイル → 契約テストタスク [P]
    - 各エンドポイント → 実装タスク

2.  **データモデルから**:

    - 各エンティティ → モデル作成タスク [P]
    - 関係 → サービスレイヤータスク

3.  **ユーザーストーリーから**:

    - 各ストーリー → 結合テスト [P]
    - クイックスタートシナリオ → 検証タスク

4.  **順序付け**:

    - セットアップ → テスト → モデル → サービス → エンドポイント → 仕上げ
    - 依存関係は並行実行をブロックする

## **検証チェックリスト**

_ゲート: `main()`が返す前にチェック_

- [ ] すべての契約に対応するテストがあるか
- [ ] すべてのエンティティにモデルタスクがあるか
- [ ] すべてのテストが実装より前に置かれているか
- [ ] 並行タスクが真に独立しているか
- [ ] 各タスクが正確なファイルパスを指定しているか
- [ ] 別の`[P]`タスクと同じファイルを変更するタスクはないか

---
